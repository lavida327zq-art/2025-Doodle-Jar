<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>2025 å¹´åº¦å›é¡¾</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&family=Ma+Shan+Zheng&display=swap" rel="stylesheet">
    <style>
        /* Base Styles */
        body {
            font-family: 'Patrick Hand', 'Ma Shan Zheng', cursive, sans-serif;
            overflow-x: hidden;
        }

        /* Custom Grid Background */
        .bg-grid-paper {
            background-color: #fdfdfd;
            background-image: 
                linear-gradient(#a5b4fc 1px, transparent 1px), 
                linear-gradient(90deg, #a5b4fc 1px, transparent 1px);
            background-size: 24px 24px;
        }

        /* Utility to hide scrollbar */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* SVG Filters Class */
        .doodle-filter {
            filter: url(#squiggle);
        }

        /* Animations */
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(var(--r, 0deg)); }
            50% { transform: translateY(-5px) rotate(calc(var(--r, 0deg) + 5deg)); }
        }

        .star-float {
            animation: float 3s infinite ease-in-out;
        }

        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .animate-pop-in {
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        @keyframes stampBounce {
            0% { transform: scale(2) rotate(12deg); opacity: 0; }
            100% { transform: scale(1) rotate(12deg); opacity: 1; }
        }

        .stamp-appear {
            animation: stampBounce 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) 0.6s forwards;
            opacity: 0; /* Start hidden */
        }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/",
    "@google/genai": "https://esm.sh/@google/genai@^1.33.0",
    "framer-motion": "https://esm.sh/framer-motion@^12.23.26",
    "path": "https://esm.sh/path@^0.12.7",
    "vite": "https://esm.sh/vite@^7.3.0",
    "@vitejs/plugin-react": "https://esm.sh/@vitejs/plugin-react@^5.1.2"
  }
}
</script>
</head>
<body class="bg-grid-paper min-h-screen flex flex-col text-gray-800">

    <!-- SVG Filters Definition -->
    <svg class="absolute w-0 h-0 pointer-events-none">
        <defs>
            <filter id="squiggle">
                <feTurbulence type="fractalNoise" baseFrequency="0.02" numOctaves="3" result="noise" />
                <feDisplacementMap in="SourceGraphic" in2="noise" scale="2" />
            </filter>
        </defs>
    </svg>

    <!-- Header & Jar Section -->
    <div class="shrink-0 pt-8 pb-4 flex flex-col items-center justify-center relative z-20 bg-gradient-to-b from-white/80 to-transparent">
        <div class="text-center mb-6">
            <h1 class="text-5xl md:text-7xl font-bold text-gray-700 tracking-wide doodle-filter" style="transform: rotate(-2deg);">
                2025 å¹´åº¦å›é¡¾
            </h1>
            <p id="header-subtitle" class="mt-2 text-lg text-gray-500 font-hand">
                æœ‰äº›æ—¥å­å€¼å¾—è¢«æŠ˜å çè—
            </p>
        </div>

        <div class="relative">
            <!-- Jar Container -->
            <div id="jar" class="relative w-56 h-72 mx-auto cursor-pointer group select-none transition-transform active:scale-95">
                <svg viewBox="0 0 200 260" class="w-full h-full drop-shadow-md transition-transform duration-300 group-hover:scale-105 doodle-filter">
                    <!-- Jar Lid -->
                    <path d="M50,20 L50,10 L150,10 L150,20 Q160,20 160,30 L160,40 L40,40 L40,30 Q40,20 50,20 Z" fill="none" stroke="#4b5563" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" />
                    <line x1="40" y1="25" x2="160" y2="25" stroke="#4b5563" strokeWidth="2" />
                    <!-- Jar Body -->
                    <path d="M45,40 L45,220 Q45,250 75,250 L125,250 Q155,250 155,220 L155,40" fill="rgba(255, 255, 255, 0.4)" stroke="#4b5563" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" />
                    <!-- Reflection Lines -->
                    <path d="M140,60 Q145,100 140,140" fill="none" stroke="rgba(75, 85, 99, 0.3)" strokeWidth="2" strokeLinecap="round" />
                    <path d="M55,220 Q50,230 65,235" fill="none" stroke="rgba(75, 85, 99, 0.3)" strokeWidth="2" strokeLinecap="round" />
                </svg>

                <!-- Stars Inside Jar -->
                <div id="jar-stars" class="absolute inset-0 top-10 left-4 right-4 bottom-4 overflow-hidden pointer-events-none">
                    <!-- Stars will be injected here by JS -->
                </div>

                <!-- Label on Jar -->
                <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-center pointer-events-none">
                    <div class="bg-white/80 backdrop-blur-sm px-4 py-2 rounded-sm border border-gray-400 doodle-filter" style="transform: rotate(-2deg);">
                        <span id="remaining-count" class="text-2xl font-bold text-gray-700">40</span>
                        <span class="block text-xs text-gray-500 uppercase tracking-widest">Left</span>
                    </div>
                </div>
            </div>
            <!-- Shadow under Jar -->
            <div class="absolute -bottom-4 left-1/2 -translate-x-1/2 w-48 h-4 bg-gray-300/30 rounded-full blur-sm -z-10"></div>
        </div>
    </div>

    <!-- Wall Section -->
    <div class="flex-1 overflow-y-auto no-scrollbar relative z-10 w-full">
        <div class="max-w-7xl mx-auto px-4 py-8 pb-32">
            <div id="empty-wall-msg" class="text-center text-gray-300 text-xl mt-12 font-hand" style="transform: rotate(1deg);">
                å›å¿†å¢™ç©ºç©ºå¦‚ä¹Ÿï¼Œç‚¹å‡»æ˜Ÿæ˜Ÿå¼€å§‹è®°å½•å§ã€‚
            </div>
            <div id="wall" class="flex flex-wrap justify-center gap-6 md:gap-8">
                <!-- Pinned Notes will be injected here -->
            </div>
        </div>
    </div>

    <!-- Modal Overlay -->
    <div id="modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden">
        <div id="modal-backdrop" class="absolute inset-0 bg-black/20 backdrop-blur-sm transition-opacity duration-300 opacity-0"></div>
        
        <div id="modal-content" class="relative z-10 w-full max-w-sm aspect-square bg-yellow-100 shadow-xl flex flex-col p-8 transition-all duration-300 transform scale-90 opacity-0 doodle-filter" style="border-radius: 2px 2px 25px 2px;">
            <!-- Tape Graphic -->
            <div class="absolute -top-3 left-1/2 -translate-x-1/2 w-24 h-8 bg-white/50 doodle-filter" style="transform: translateX(-50%) rotate(-2deg);"></div>

            <!-- Question -->
            <div class="flex-1 flex flex-col items-center justify-center text-center space-y-6">
                <h2 id="modal-question" class="text-2xl text-gray-800 font-bold leading-relaxed min-h-[4rem]">
                    <!-- Question text -->
                </h2>

                <!-- Input -->
                <div class="w-full space-y-2">
                    <input type="text" id="modal-input" placeholder="Write your thought..." class="w-full bg-transparent border-b-2 border-gray-400 focus:border-blue-500 outline-none text-xl text-center pb-1 font-hand placeholder:text-gray-400/70" autocomplete="off" />
                </div>
            </div>

            <!-- Action Button -->
            <div class="mt-4 text-center">
                <button id="btn-pin" disabled class="doodle-filter text-lg font-bold px-6 py-2 border-2 border-gray-700 rounded-full transition-all transform hover:scale-105 active:scale-95 bg-gray-100 text-gray-400 border-gray-300 cursor-not-allowed">
                    Pin It
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- DATA ---
        // Base questions (10), repeated to make 40 as requested
        const BASE_QUESTIONS = [
            "ä½ ä»Šå¹´åšäº†å“ªäº›ä¹‹å‰ä»æœªåšè¿‡çš„äº‹ï¼Ÿ",
            "ä½ æœ‰æ²¡æœ‰éµå®ˆå¹´åˆæ—¶å’Œè‡ªå·±è®¸ä¸‹çš„çº¦å®šï¼Ÿ",
            "ä½ èº«è¾¹æœ‰äººç”Ÿå­©å­äº†å—ï¼Ÿ",
            "ä½ èº«è¾¹æœ‰äººå»ä¸–äº†å—ï¼Ÿ",
            "ä½ å»äº†å“ªäº›åŸå¸‚/å·/å›½å®¶ï¼Ÿ",
            "æ˜å¹´ä½ æƒ³è¦è·å¾—å“ªäº›ä½ ä»Šå¹´æ²¡æœ‰çš„ä¸œè¥¿ï¼Ÿ",
            "ä»Šå¹´çš„å“ªä¸ªæˆ–å“ªäº›æ—¥å­ä¼šé“­åˆ»åœ¨ä½ çš„è®°å¿†ä¸­ï¼Œä¸ºä»€ä¹ˆï¼Ÿ",
            "ä½ ä»Šå¹´æœ€å¤§çš„æˆå°±æ˜¯ä»€ä¹ˆï¼Ÿ",
            "ä½ ä»Šå¹´æœ€å¤§çš„å¤±è´¥æ˜¯ä»€ä¹ˆï¼Ÿ",
            "ä½ ä»Šå¹´è¿˜é‡åˆ°è¿‡å“ªäº›å›°éš¾ï¼Ÿ"
        ];
        
        // Generate 40 questions
        let questions = [];
        for (let i = 0; i < 4; i++) {
            questions = questions.concat(BASE_QUESTIONS);
        }

        // --- STATE ---
        let pinnedNotes = [];
        let currentQuestion = null;
        let isModalOpen = false;

        // --- CONSTANTS ---
        const STAMPS = ['rabbit', 'cat', 'bear', 'star', 'heart'];
        const COLORS = ['bg-yellow-100', 'bg-blue-100', 'bg-rose-100', 'bg-green-100', 'bg-orange-100'];
        const STAR_COLORS = ['#fde047', '#bef264', '#fcd34d', '#86efac', '#93c5fd'];

        // --- DOM ELEMENTS ---
        const jarEl = document.getElementById('jar');
        const jarStarsContainer = document.getElementById('jar-stars');
        const countEl = document.getElementById('remaining-count');
        const wallEl = document.getElementById('wall');
        const emptyWallMsg = document.getElementById('empty-wall-msg');
        const headerSubtitle = document.getElementById('header-subtitle');
        
        const modalEl = document.getElementById('modal');
        const modalBackdrop = document.getElementById('modal-backdrop');
        const modalContent = document.getElementById('modal-content');
        const modalQuestionEl = document.getElementById('modal-question');
        const modalInput = document.getElementById('modal-input');
        const btnPin = document.getElementById('btn-pin');

        // --- UTILS ---
        function randomItem(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        function getStampSVG(type) {
            const commonProps = 'stroke="currentColor" stroke-width="1.5" fill="none" viewBox="0 0 24 24" class="w-12 h-12"';
            switch (type) {
                case 'cat':
                    return `<svg ${commonProps}><path d="M12 5C10 5 9 7 9 7L7 5L5 9C5 9 6 12 6 14C6 17.3137 8.68629 20 12 20C15.3137 20 18 17.3137 18 14C18 12 19 9 19 9L17 5L15 7C15 7 14 5 12 5Z" /><path d="M9 14L8 15" stroke-linecap="round" /><path d="M15 14L16 15" stroke-linecap="round" /><circle cx="10.5" cy="13" r="0.5" fill="currentColor" /><circle cx="13.5" cy="13" r="0.5" fill="currentColor" /><path d="M11.5 16C11.5 16 12 16.5 12.5 16" stroke-linecap="round" /></svg>`;
                case 'bear':
                    return `<svg ${commonProps}><path d="M7 6C7 6 5 4 4 6C3 8 5 9 5 9" stroke-linecap="round" /><path d="M17 6C17 6 19 4 20 6C21 8 19 9 19 9" stroke-linecap="round" /><circle cx="12" cy="13" r="8" /><circle cx="10" cy="11" r="1" fill="currentColor" /><circle cx="14" cy="11" r="1" fill="currentColor" /><ellipse cx="12" cy="15" rx="2.5" ry="1.5" /><circle cx="12" cy="14.5" r="0.5" fill="currentColor" /></svg>`;
                case 'star':
                    return `<svg ${commonProps}><path d="M12 2L14.4 9.6L22 12L14.4 14.4L12 22L9.6 14.4L2 12L9.6 9.6L12 2Z" /><circle cx="12" cy="12" r="1" fill="currentColor" /></svg>`;
                case 'heart':
                    return `<svg ${commonProps}><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" /><path d="M18 6L19 5" stroke-linecap="round" /><path d="M6 6L5 5" stroke-linecap="round" /></svg>`;
                case 'rabbit':
                default:
                    return `<svg ${commonProps}><circle cx="12" cy="15" r="5" /><path d="M9 11C9 11 7 5 9 3C11 1 11 5 11 8" stroke-linecap="round" /><path d="M15 11C15 11 17 5 15 3C13 1 13 5 13 8" stroke-linecap="round" /><circle cx="10.5" cy="14" r="0.5" fill="currentColor" /><circle cx="13.5" cy="14" r="0.5" fill="currentColor" /><path d="M11 16L12 17L13 16" stroke-linecap="round" /></svg>`;
            }
        }

        // --- INIT STARS ---
        // Create 20 visual stars initially (max visual limit)
        function renderJarStars() {
            jarStarsContainer.innerHTML = '';
            const count = questions.length;
            const visibleCount = Math.min(count, 20); // Cap visual stars at 20

            for (let i = 0; i < visibleCount; i++) {
                const star = document.createElement('div');
                star.className = 'absolute star-float';
                
                // Random properties
                const x = Math.random() * 140 + 20; // 20 to 160 width
                const y = Math.random() * 120 + 60; // 60 to 180 height
                const scale = 0.6 + Math.random() * 0.4;
                const rotation = Math.random() * 360;
                const delay = Math.random() * 2;
                const color = randomItem(STAR_COLORS);

                star.style.left = `${x}px`;
                star.style.top = `${y}px`;
                star.style.setProperty('--r', `${rotation}deg`);
                star.style.animationDelay = `${delay}s`;
                
                // SVG Content
                star.innerHTML = `
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="${color}" stroke="#4b5563" stroke-width="1.5" stroke-linejoin="round" class="doodle-filter" style="transform: scale(${scale})">
                        <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" />
                    </svg>
                `;
                
                jarStarsContainer.appendChild(star);
            }
        }

        // --- MODAL LOGIC ---
        function openModal() {
            if (questions.length === 0 || isModalOpen) return;

            // Pick first question (simulate popping from stack)
            currentQuestion = questions[0];
            
            modalQuestionEl.textContent = currentQuestion;
            modalInput.value = '';
            checkInput(); // Reset button state
            
            modalEl.classList.remove('hidden');
            
            // Animation loop for entry
            requestAnimationFrame(() => {
                modalBackdrop.classList.remove('opacity-0');
                modalContent.classList.remove('scale-90', 'opacity-0');
                modalContent.classList.add('scale-100', 'opacity-100');
            });
            
            // Focus input after transition
            setTimeout(() => modalInput.focus(), 100);
            
            isModalOpen = true;
        }

        function closeModal() {
            modalBackdrop.classList.add('opacity-0');
            modalContent.classList.remove('scale-100', 'opacity-100');
            modalContent.classList.add('scale-90', 'opacity-0');
            
            setTimeout(() => {
                modalEl.classList.add('hidden');
                isModalOpen = false;
                currentQuestion = null;
            }, 300);
        }

        function checkInput() {
            const hasText = modalInput.value.trim().length > 0;
            btnPin.disabled = !hasText;
            if (hasText) {
                btnPin.classList.remove('bg-gray-100', 'text-gray-400', 'border-gray-300', 'cursor-not-allowed');
                btnPin.classList.add('bg-white', 'text-gray-800', 'shadow-md', 'hover:bg-green-50', 'border-gray-700');
            } else {
                btnPin.classList.add('bg-gray-100', 'text-gray-400', 'border-gray-300', 'cursor-not-allowed');
                btnPin.classList.remove('bg-white', 'text-gray-800', 'shadow-md', 'hover:bg-green-50', 'border-gray-700');
            }
        }

        function handlePin() {
            const answer = modalInput.value.trim();
            if (!answer) return;

            // Remove question from list
            questions.shift();
            
            // Update Jar
            countEl.textContent = questions.length;
            renderJarStars(); // Re-render to remove one star visually (if < 20)

            // Update Header if empty
            if (questions.length === 0) {
                headerSubtitle.innerHTML = '<span class="text-green-600 font-bold">ğŸ‰ 2025 å¹´å¿«ä¹ï¼ ğŸ‰</span>';
                countEl.parentElement.classList.add('animate-bounce');
            }

            // Create Note
            const noteData = {
                id: Date.now(),
                question: currentQuestion,
                answer: answer,
                rotation: (Math.random() * 6) - 3,
                color: randomItem(COLORS),
                stamp: randomItem(STAMPS)
            };
            
            addNoteToWall(noteData);
            closeModal();
        }

        function addNoteToWall(data) {
            emptyWallMsg.classList.add('hidden');
            
            const note = document.createElement('div');
            note.className = `relative w-64 h-64 ${data.color} shadow-sm p-6 flex flex-col items-center justify-center text-center overflow-hidden shrink-0 animate-pop-in doodle-filter`;
            note.style.borderRadius = '2px 2px 15px 2px';
            note.style.transform = `rotate(${data.rotation}deg)`; // Initial rotation for static state (animation overrides this briefly)
            // Note: animate-pop-in uses scale/opacity. We can set the final rotation in the element's style, 
            // but the keyframe animation transforms might conflict. 
            // Better approach: wrap content or use `animation-fill-mode`.
            // Ideally, we just apply the rotation to the wrapper or modify the keyframe dynamically. 
            // For simplicity, let's just let it pop in, and set the final rotation via style which applies after animation if we structured it right, 
            // OR simpler: don't animate rotation in keyframe, just scale/opacity.
            
            // To ensure rotation sticks, we apply it to the element directly.
            // The keyframe `popIn` only touches scale/opacity. The `transform` in style might be overwritten by animation `transform`.
            // Workaround: Animate a wrapper, or use specific property transition. 
            // Let's rely on standard CSS transition for entry if possible, or just accept that during animation it's 0deg.
            // Actually, we can just set `transform: rotate(...) scale(1)` in the final state, but animation makes that hard.
            // Let's just use a simple transition class instead of keyframe for the entry to keep rotation.
            note.classList.remove('animate-pop-in');
            note.style.opacity = '0';
            note.style.transform = `scale(0.8) rotate(${data.rotation}deg)`;
            note.style.transition = 'all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)';

            note.innerHTML = `
                <div class="absolute -top-3 left-1/2 -translate-x-1/2 w-16 h-6 bg-white/40 transform -rotate-1 shadow-sm"></div>
                <div class="flex-1 flex flex-col justify-center gap-3 w-full">
                    <p class="text-sm text-gray-500 font-hand leading-tight line-clamp-3 italic">"${data.question}"</p>
                    <div class="w-full h-px bg-gray-400/20 my-1"></div>
                    <p class="text-xl text-gray-800 font-hand font-bold leading-tight break-words">${data.answer}</p>
                </div>
                <!-- Stamp -->
                <div class="absolute bottom-3 right-3 text-red-500/70 pointer-events-none stamp-appear">
                    <div class="relative">
                        ${getStampSVG(data.stamp)}
                        <div class="absolute inset-0 rounded-full border-2 border-dashed border-current opacity-50 scale-125"></div>
                    </div>
                </div>
            `;

            // Insert at top
            wallEl.insertBefore(note, wallEl.firstChild);

            // Trigger animation next frame
            requestAnimationFrame(() => {
                note.style.opacity = '1';
                note.style.transform = `scale(1) rotate(${data.rotation}deg)`;
            });
        }

        // --- EVENT LISTENERS ---
        jarEl.addEventListener('click', openModal);
        
        modalBackdrop.addEventListener('click', closeModal);
        
        modalInput.addEventListener('input', checkInput);
        
        modalInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !btnPin.disabled) {
                handlePin();
            }
        });

        btnPin.addEventListener('click', handlePin);

        // --- INITIAL RENDER ---
        renderJarStars();
        countEl.textContent = questions.length;

    </script>
</body>
</html>
